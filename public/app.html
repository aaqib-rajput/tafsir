<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tafsir Session Manager</title>
<style>
:root{font-family:Inter,system-ui,sans-serif}
*{box-sizing:border-box}
body{margin:0;min-height:100vh;background:#dfe3ec;padding:14px}
.app{max-width:1240px;margin:0 auto;display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
.panel{background:#ececec;border:1px solid #cdd3df;border-radius:18px;padding:18px}
h1{margin:0 0 10px;font-size:34px}
.row{display:flex;gap:10px;align-items:center}
.space{justify-content:space-between;font-size:34px;font-weight:700;margin-bottom:8px}
.counts-green{color:#059669}.counts-red{color:#ef4444}
input,select{width:100%;padding:10px 14px;border:1px solid #bcc3cf;border-radius:12px;font-size:32px;background:#f9fafb}
button{border:0;border-radius:12px;padding:10px 16px;font-size:33px;cursor:pointer}
.primary{background:#4f46e5;color:#fff}.control-btn{background:#cdd7f8}.absent-btn{background:#f7c9c9}.remove-btn{background:#e5e7eb}
.present-btn{background:#dbeafe}.speak-btn{background:#c7d2fe}.queue-btn{background:#d5def7}
.note{font-size:31px;color:#6b7280;margin:8px 0 10px}
.scroll{max-height:610px;overflow-y:auto;border:1px solid #cfd5df;border-radius:14px;padding:8px;background:#ebebeb}
.item{display:flex;justify-content:space-between;gap:14px;padding:12px;border:1px solid #ccd2dc;border-radius:14px;background:#f3f4f6;margin-bottom:8px}
.item.present{background:#dcfce7}.item.absent{background:#fee2e2}.item.speaking{outline:2px solid #4f46e5}
.item-name{font-size:39px;line-height:1.2}
.actions{display:flex;gap:8px;flex-wrap:wrap}
.actions button{min-width:118px}
.card{background:#f9fafb;border-radius:14px;padding:14px;border:1px solid #d5dae3}
.badge{display:inline-block;background:#eef2ff;padding:2px 10px;border-radius:999px;font-size:28px}
ul{margin:0;padding:0;list-style:none}
.small{font-size:28px;color:#6b7280}
@media (max-width:1200px){.app{grid-template-columns:1fr}h1,.space,input,select,button,.note,.item-name,.small,.badge{font-size:18px}}
</style>
</head>
<body>
<main class="app">
  <section class="panel">
    <h1>Attendance</h1>
    <div class="row space">
      <span>Total: <span id="totalCount">0</span></span>
      <span class="counts-green">Present: <span id="presentCount">0</span></span>
      <span class="counts-red">Absent: <span id="absentCount">0</span></span>
    </div>

    <div class="row" style="margin-bottom:10px">
      <input id="nameInput" placeholder="Search member or add new member..." />
      <button id="addBtn" class="primary">Add</button>
    </div>

    <div class="row" style="margin-bottom:10px">
      <select id="teamSessionSelect">
        <option value="ALL">ALL Teams</option>
        <option value="Team A">Team A</option>
        <option value="Team B">Team B</option>
        <option value="Team C">Team C</option>
      </select>
      <button id="applyTeamSession" class="control-btn">Load Team</button>
      <button id="resetDefaultSession" class="absent-btn">Reset Default</button>
    </div>

    <div class="note">Search filters attendance list. Add creates a new member at end of full list.</div>

    <div class="scroll"><ul id="attendanceList"></ul></div>
  </section>

  <section class="panel">
    <h1>Speaking Summary</h1>
    <div class="card" style="margin-bottom:10px"><span class="small">Current queue:</span><div id="queueBox" style="margin-top:8px"></div></div>
    <div class="scroll"><ul id="summaryList"></ul></div>
  </section>
</main>

<script>
const TEAM_DATA={
  "Team A":["Nadeem","Zoya","Rohma Zil Arsh","Sameen Zara","Ahmad Adrees"],
  "Team B":["Aqib","Khadija","Malaika Imran","Hasnat Fatima","Abdullah Shahbaz"],
  "Team C":["Saboor","Kamran","Sidra Younas","Ishrat Fatima","Saddam Sharif"]
};

let members=[];
let currentSpeakerId=null;
let speakerQueue=[];

function format(sec){return `${String(Math.floor(sec/60)).padStart(2,'0')}:${String(sec%60).padStart(2,'0')}`}

function saveState(){localStorage.setItem('tsm_att_members',JSON.stringify(members))}
function loadState(){
  try{
    const data=JSON.parse(localStorage.getItem('tsm_att_members')||'null');
    if(Array.isArray(data)&&data.length){members=data;return;}
  }catch(e){}
  loadTeamSession('ALL',false);
}

function loadTeamSession(teamName,rerender=true){
  const names=teamName==='ALL'?Object.values(TEAM_DATA).flat():TEAM_DATA[teamName]||[];
  members=[...new Set(names)].map((name,i)=>({id:`${Date.now()}_${i}_${Math.random()}`,name,attendance:'',role:'participant',time:0,speakLimit:120}));
  currentSpeakerId=null;
  speakerQueue=[];
  if(rerender) render();
}

function renderQueue(){
  const q=document.getElementById('queueBox');q.innerHTML='';
  if(!speakerQueue.length){q.innerHTML='<span class="small">No queued speakers</span>';return;}
  speakerQueue.forEach(id=>{
    const m=members.find(x=>x.id===id);if(!m) return;
    const s=document.createElement('span');s.className='badge';s.style.marginRight='8px';s.textContent=m.name;q.appendChild(s);
  });
}

function render(){
  const list=document.getElementById('attendanceList');
  const sum=document.getElementById('summaryList');
  const q=document.getElementById('nameInput').value.trim().toLowerCase();
  list.innerHTML='';sum.innerHTML='';
  let present=0,absent=0;
  members.forEach(m=>{if(m.attendance==='present')present++; if(m.attendance==='absent')absent++;});

  members.filter(m=>!q||m.name.toLowerCase().includes(q)).forEach(m=>{
    const li=document.createElement('li');li.className='item';
    if(m.attendance) li.classList.add(m.attendance);
    if(m.id===currentSpeakerId) li.classList.add('speaking');

    const n=document.createElement('div');n.className='item-name';n.textContent=`${m.name} [${m.role}] (${format(m.time)} / ${format(m.speakLimit)})`;
    const a=document.createElement('div');a.className='actions';

    const p=document.createElement('button');p.className='present-btn';p.textContent='Present';
    p.onclick=()=>{m.attendance='present';render();};

    const s=document.createElement('button');s.className='speak-btn';s.textContent='Speak';
    s.onclick=()=>{if(m.attendance==='absent')return;currentSpeakerId=m.id;if(!speakerQueue.includes(m.id))speakerQueue=speakerQueue.filter(id=>id!==m.id);renderQueue();render();};

    const qbtn=document.createElement('button');qbtn.className='queue-btn';qbtn.textContent='Queue';
    qbtn.onclick=()=>{if(!speakerQueue.includes(m.id) && currentSpeakerId!==m.id) speakerQueue.push(m.id);renderQueue();};

    const ab=document.createElement('button');ab.className='absent-btn';ab.textContent='Absent';
    ab.onclick=()=>{m.attendance='absent';if(currentSpeakerId===m.id)currentSpeakerId=null;speakerQueue=speakerQueue.filter(id=>id!==m.id);renderQueue();render();};

    const r=document.createElement('button');r.className='remove-btn';r.textContent='Remove';
    r.onclick=()=>{members=members.filter(x=>x.id!==m.id);speakerQueue=speakerQueue.filter(id=>id!==m.id);if(currentSpeakerId===m.id)currentSpeakerId=null;renderQueue();render();};

    a.append(p,s,qbtn,ab,r);li.append(n,a);list.appendChild(li);

    if(m.time>0){const sli=document.createElement('li');sli.className='item';sli.innerHTML=`<span class="item-name">${m.name}</span><span class="badge">${format(m.time)}</span>`;sum.appendChild(sli);}
  });

  document.getElementById('totalCount').textContent=members.length;
  document.getElementById('presentCount').textContent=present;
  document.getElementById('absentCount').textContent=absent;
  saveState();
}

document.getElementById('addBtn').onclick=()=>{
  const input=document.getElementById('nameInput');
  const name=input.value.trim();
  if(!name) return;
  if(members.some(m=>m.name.toLowerCase()===name.toLowerCase())){render();return;}
  members.push({id:`${Date.now()}_${Math.random()}`,name,attendance:'',role:'participant',time:0,speakLimit:120});
  input.value='';
  render();
};

document.getElementById('nameInput').addEventListener('input',render);
document.getElementById('nameInput').addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault();document.getElementById('addBtn').click();}});
document.getElementById('applyTeamSession').onclick=()=>loadTeamSession(document.getElementById('teamSessionSelect').value);
document.getElementById('resetDefaultSession').onclick=()=>{document.getElementById('teamSessionSelect').value='ALL';loadTeamSession('ALL');};

loadState();
renderQueue();
render();
</script>
</body>
</html>
